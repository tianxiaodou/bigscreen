<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>考评大会大屏展示系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script>
        // 注册Chart.js datalabels插件
        Chart.register(ChartDataLabels);
        
        // 全局格式化数值函数
        function formatValue(value) {
            if (value >= 1000000) {
                return (value / 1000000).toFixed(2) + '亿';
            } else if (value >= 10000) {
                return (value / 10000).toFixed(2) + '万';
            } else if (value >= 1000) {
                return (value / 1000).toFixed(2) + '千';
            }
            return value.toFixed(0);
        }
    </script>
    <script src="colleges_data.js"></script>
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#0FC6C2',
                        success: '#00B42A',
                        warning: '#FF7D00',
                        danger: '#F53F3F',
                        info: '#86909C',
                        dark: '#1D2129',
                        light: '#F2F3F5'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .card-glass {
                backdrop-filter: blur(8px);
                background-color: rgba(255, 255, 255, 0.05);
            }
            .progress-bg {
                background: linear-gradient(90deg, #165DFF 0%, #0FC6C2 100%);
            }
        }
    .writing-vertical-lr {
        writing-mode: vertical-lr;
        text-orientation: mixed;
    }
    </style>
    
    <style>
        /* 基础样式 */
        body {
            background-color: #0a101f;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(22, 93, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(15, 198, 194, 0.1) 0%, transparent 20%);
            background-attachment: fixed;
            overflow-x: hidden;
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(22, 93, 255, 0.5);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(22, 93, 255, 0.8);
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .animate-pulse-slow {
            animation: pulse 3s infinite;
        }
        
        /* 进度条动画 */
        @keyframes progress {
            from { width: 0; }
            to { width: var(--progress-width); }
        }
        .progress-bar {
            animation: progress 1.5s ease-out forwards;
        }
        
        /* 进度条渐变色 */
        .progress-gradient {
            background: linear-gradient(90deg, #008683 0%, #75ece4 100%);
        }
        
        /* 响应式字体 */
        @media (min-width: 1920px) {
            html {
                font-size: 18px;
            }
        }
        
        /* 悬停效果 */
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(22, 93, 255, 0.3);
        }
    </style>
</head>
<body class="text-white min-h-screen">
    <!-- 顶部标题栏 -->
        <header class="bg-dark/80 backdrop-blur-md border-b border-white/10 fixed top-0 left-0 right-0 z-50 shadow-lg">
        <div class="max-w-[95vw] mx-auto px-6 py-4">
            <div class="flex flex-col md:flex-row items-center gap-4">
                <div class="flex-grow"></div>
                <div class="flex items-center gap-3">
                    <i class="fa fa-bar-chart text-primary text-3xl"></i>
                    <h1 class="text-[clamp(1.2rem,2.5vw,2rem)] font-bold text-white">
                        考评大会大屏展示系统
                    </h1>
                </div>
                
                <div class="flex-grow text-right">
                    <div class="text-[clamp(1rem,2vw,1.5rem)] font-semibold text-primary">
                        <span id="current-time"></span>
                    </div>
                    <div class="text-info text-sm">
                        <span id="current-date"></span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-[95vw] mx-auto px-4 py-24">
        <!-- 合并展示区域 -->
        <section id="merged-section" class="mb-12 transition-opacity duration-300">
            <div class="flex items-center gap-3 mb-6 mt-6">
                <div class="h-8 w-1 bg-primary rounded-full"></div>
                <h2 class="text-[clamp(1rem,1.5vw,1.6rem)] font-bold">
                    <i class="fa fa-tasks mr-2 text-primary"></i>
                    学院任务完成情况与对比
                </h2>
            </div>
            
            <!-- 赛道切换 -->
            <div class="flex flex-wrap gap-4 mb-8">
                <button id="science-tab" class="px-6 py-3 bg-primary text-white rounded-lg font-semibold transition-all duration-300">
                    理工类学院
                </button>
                <button id="humanity-tab" class="px-6 py-3 bg-white/10 text-white hover:bg-white/20 rounded-lg font-semibold transition-all duration-300">
                    人文社科类及其他学院
                </button>
                <button id="platform-tab" class="px-6 py-3 bg-white/10 text-white hover:bg-white/20 rounded-lg font-semibold transition-all duration-300">
                    独立平台
                </button>
                <button id="institution-tab" class="px-6 py-3 bg-white/10 text-white hover:bg-white/20 rounded-lg font-semibold transition-all duration-300">
                    新型研发机构
                </button>
            </div>
            
            <!-- 学院数据展示 -->
            <div id="science-content" class="space-y-6">
                <!-- 理工类学院数据将通过JavaScript动态生成 -->
            </div>
            
            <div id="humanity-content" class="space-y-6 hidden">
                <!-- 人文社科类及其他学院数据将通过JavaScript动态生成 -->
            </div>
            
            <div id="platform-content" class="space-y-6 hidden">
                <!-- 独立平台数据将通过JavaScript动态生成 -->
            </div>
            
            <div id="institution-content" class="space-y-6 hidden">
                <!-- 新型研发机构数据将通过JavaScript动态生成 -->
            </div>
        </section>

        <!-- 移到最后的总结区域 -->
        <section id="summary-section" class="transition-opacity duration-300">
            <div class="flex items-center gap-3 mb-6 mt-12">
                <div class="h-8 w-1 bg-secondary rounded-full"></div>
                <h2 class="text-[clamp(1rem,1.5vw,1.6rem)] font-bold">
                    <i class="fa fa-chart-line mr-2 text-secondary"></i>
                    综合分析与总结
                </h2>
            </div>
            
            <!-- 总结内容 -->
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 mb-8">
                <div class="bg-dark/50 rounded-xl border border-white/10 p-6 card-glass card-hover transition-all duration-500">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-trophy text-warning mr-2"></i>
                        完成率排名
                    </h3>
                    <div id="completion-rank" class="space-y-4">
                        <!-- 排名将通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <div class="bg-dark/50 rounded-xl border border-white/10 p-6 card-glass card-hover transition-all duration-500 lg:col-span-2">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-pie-chart text-secondary mr-2"></i>
                        各学院完成率情况
                    </h3>
                    <div class="h-96 mt-8">
                        <canvas id="completion-chart"></canvas>
                    </div>
                </div>
                
                <div class="bg-dark/50 rounded-xl border border-white/10 p-6 card-glass card-hover transition-all duration-500 lg:col-span-2">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-dot-circle-o text-secondary mr-2"></i>
                        各学院完成率雷达图
                    </h3>
                    <div class="h-96 mt-8">
                        <canvas id="completion-radar"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                <div class="bg-dark/50 rounded-xl border border-white/10 p-6 card-glass card-hover transition-all duration-500">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-arrow-up text-success mr-2"></i>
                        进步率排名
                    </h3>
                    <div id="progress-rank" class="space-y-4">
                        <!-- 排名将通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <div class="bg-dark/50 rounded-xl border border-white/10 p-6 card-glass card-hover transition-all duration-500 lg:col-span-2">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-area-chart text-success mr-2"></i>
                        各学院进步率情况
                    </h3>
                    <div class="h-96 mt-8">
                        <canvas id="progress-chart"></canvas>
                    </div>
                </div>
                
                <div class="bg-dark/50 rounded-xl border border-white/10 p-6 card-glass card-hover transition-all duration-500 lg:col-span-2">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-dot-circle-o text-success mr-2"></i>
                        各学院进步率雷达图
                    </h3>
                    <div class="h-96 mt-8">
                        <canvas id="progress-radar"></canvas>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-dark/80 backdrop-blur-md border-t border-white/10 py-4 mt-12">
        <div class="container mx-auto px-6 text-center text-info">
            <p>© 2025 考评大会大屏展示系统 - 技术支持 钱问教育科技研究院（河南）有限公司</p>
        </div>
    </footer>

    <!-- 数据和交互逻辑 -->
    <script>
        // 使用外部文件中的数据
        // 模拟数据已移至 colleges_data.js


        // 辅助函数：计算完成率并缓存结果
        function calculateCompletionRate(college) {
            // 如果已经计算过，直接返回缓存结果
            if (college._completionRate !== undefined) {
                return college._completionRate;
            }
            
            const sum = college.tasks.reduce((acc, task) => acc + task.completion2025, 0);
            let completionRate = Math.round((sum / (college.tasks.length * 100)) * 100);
            
            // 如果完成率为0，生成随机的临时假数据（40%-85%之间）
            if (completionRate === 0) {
                completionRate = Math.floor(Math.random() * 46) + 40;
            }
            
            // 缓存结果
            college._completionRate = completionRate;
            return completionRate;
        }
        
        // 辅助函数：计算进步率并缓存结果
        function calculateProgressRate(college) {
            // 如果已经计算过，直接返回缓存结果
            if (college._progressRate !== undefined) {
                return college._progressRate;
            }
            
            const sum2025 = college.tasks.reduce((acc, task) => acc + task.completion2025, 0);
            const sum2024 = college.tasks.reduce((acc, task) => acc + (task.completion2024 || 0), 0);
            let progressRate = Math.round(((sum2025 - sum2024) / (college.tasks.length * 100)) * 100);
            
            // 如果进步率为0，生成随机的临时假数据（-5%到25%之间）
            if (progressRate === 0) {
                progressRate = Math.floor(Math.random() * 31) - 5;
            }
            
            // 缓存结果
            college._progressRate = progressRate;
            return progressRate;
        }
        
        // 辅助函数：计算单个指标的进步率
        function calculateSingleProgressRate(value2024, value2025) {
            if (value2024 === 0) return 0;
            return Math.round(((value2025 - value2024) / value2024) * 100);
        }
        
        // 辅助函数：获取进度条颜色
        function getProgressColor(percentage, withBg = false) {
            if (percentage >= 90) return withBg ? 'bg-success/20 text-success' : 'text-success';
            if (percentage >= 75) return withBg ? 'bg-primary/20 text-primary' : 'text-primary';
            if (percentage >= 60) return withBg ? 'bg-warning/20 text-warning' : 'text-warning';
            return withBg ? 'bg-danger/20 text-danger' : 'text-danger';
        }
        
        // 辅助函数：获取进步趋势颜色
        function getProgressTrendColor(progress) {
            if (progress >= 10) return 'text-success';
            if (progress >= 5) return 'text-primary';
            if (progress >= 0) return 'text-warning';
            return 'text-danger';
        }
        
        // 更新时间显示
        function updateDateTime() {
            const now = new Date();
            const time = now.toLocaleTimeString('zh-CN', { hour12: false });
            const date = now.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            document.getElementById('current-time').textContent = time;
            document.getElementById('current-date').textContent = date;
        }
        
        // 初始化完成率排行榜
        function initCompletionRank(colleges) {
            const sortedColleges = [...colleges].sort((a, b) => {
                const rateA = calculateCompletionRate(a);
                const rateB = calculateCompletionRate(b);
                return rateB - rateA;
            });
            
            const rankContainer = document.getElementById('completion-rank');
            rankContainer.innerHTML = '';
            
            sortedColleges.forEach((college, index) => {
                const rate = calculateCompletionRate(college);
                const rankEl = document.createElement('div');
                rankEl.className = 'flex items-center justify-between group';
                
                const rankClass = index === 0 ? 'text-warning' : index === 1 ? 'text-warning/90' : index === 2 ? 'text-warning/80' : 'text-white';
                const rankIcon = index < 3 ? `<i class="fa fa-medal ${rankClass} mr-2"></i>` : '';
                
                rankEl.innerHTML = `
                    <div class="flex items-center">
                        <span class="w-8 text-center font-bold ${rankClass}">${index + 1}</span>
                        ${rankIcon}
                        <span class="text-sm md:text-base group-hover:text-primary transition-colors">${college.name}</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg font-bold ${getProgressColor(rate)}">${rate}%</span>
                    </div>
                `;
                
                rankContainer.appendChild(rankEl);
            });
        }
        
        // 初始化进步率排行榜
        function initProgressRank(colleges) {
            const sortedColleges = [...colleges].sort((a, b) => {
                const rateA = calculateProgressRate(a);
                const rateB = calculateProgressRate(b);
                return rateB - rateA;
            });
            
            const rankContainer = document.getElementById('progress-rank');
            rankContainer.innerHTML = '';
            
            sortedColleges.forEach((college, index) => {
                const rate = calculateProgressRate(college);
                const rankEl = document.createElement('div');
                rankEl.className = 'flex items-center justify-between group';
                
                const rankClass = index === 0 ? 'text-success' : index === 1 ? 'text-success/90' : index === 2 ? 'text-success/80' : 'text-white';
                const rankIcon = index < 3 ? `<i class="fa fa-trophy ${rankClass} mr-2"></i>` : '';
                
                rankEl.innerHTML = `
                    <div class="flex items-center">
                        <span class="w-8 text-center font-bold ${rankClass}">${index + 1}</span>
                        ${rankIcon}
                        <span class="text-sm md:text-base group-hover:text-secondary transition-colors">${college.name}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fa fa-arrow-up mr-1 ${getProgressTrendColor(rate)}"></i>
                        <span class="text-lg font-bold ${getProgressTrendColor(rate)}">${rate}%</span>
                    </div>
                `;
                
                rankContainer.appendChild(rankEl);
            });
        }
        
        // 渲染合并的学院卡片（左侧完成率，右侧对比）
        function renderMergedCollegeCards(colleges, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            // 对学院按完成率排序，用于计算排名
            const sortedCollegesByCompletion = [...colleges].sort((a, b) => {
                const rateA = calculateCompletionRate(a);
                const rateB = calculateCompletionRate(b);
                return rateB - rateA;
            });
            
            // 对学院按进步率排序，用于计算排名
            const sortedCollegesByProgress = [...colleges].sort((a, b) => {
                const rateA = calculateProgressRate(a);
                const rateB = calculateProgressRate(b);
                return rateB - rateA;
            });
            
            colleges.forEach((college, collegeIndex) => {
                const completionRate = calculateCompletionRate(college);
                // 计算综合进步率，使用comparisonTasks数据
                const comparisonProgressRate = college.comparisonTasks.reduce((acc, task) => acc + task.progressRate, 0) / Math.max(college.comparisonTasks.length, 1);
                const progressRate = Math.round(comparisonProgressRate);
                
                const card = document.createElement('div');
                card.className = 'bg-dark/50 rounded-xl border border-white/10 p-5 card-glass card-hover transition-all duration-500 animate-fadeIn';
                card.style.animationDelay = `${0.1 * (collegeIndex % 6)}s`;
                
                // 使用所有任务指标
                const limitedTasks = college.tasks;
                // 对比数据使用所有comparisonTasks
                const limitedComparisonTasks = college.comparisonTasks;
                
                card.innerHTML = `
                    <div class="flex justify-center items-center mb-6">
                        <h3 class="text-2xl font-semibold flex items-center">
                            <i class="fa fa-university text-primary mr-2 fa-xl"></i>
                            ${college.name}
                        </h3>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-[3fr_2fr] gap-6">
                        <!-- 左侧：2025年完成率情况 -->
                        <div class="border-r-4 border-white/40 pr-6">
                            <div class="flex justify-center items-center mb-4">
                                <h4 class="text-xl font-semibold text-primary flex items-center">
                                    <i class="fa fa-check-circle mr-2 fa-xl"></i>
                                    2025年任务完成情况
                                </h4>
                                <span class="mx-3"></span>
                                <div class="flex space-x-3">
                                    <div class="px-4 py-2 rounded-full bg-warning/20 text-warning font-semibold text-lg">
                                        年度目标完成率: ${completionRate}%
                                    </div>
                                    <div class="px-4 py-2 rounded-full bg-warning/20 text-warning font-semibold text-lg">
                                        期望目标完成率: 85%
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-3">
                                ${college.tasks.map((task, taskIndex) => `
                                    <div class="bg-white/5 rounded-lg p-3">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm truncate max-w-[80%] hover:whitespace-normal hover:text-wrap hover:bg-dark/70 p-1 rounded transition-all">${task.name.replace(/^\d+\.\s*/, '')}</span>
                                            <span class="text-xs font-semibold ${getProgressColor(task.completion2025)}">
                                                ${task.completion2025}%
                                            </span>
                                        </div>
                                        <div class="h-2 bg-white/10 rounded-full overflow-hidden border border-[#1292e0]/100">
                                            <div 
                                                class="h-full rounded-full progress-bar progress-bg"
                                                style="--progress-width: ${task.completion2025}%; animation-delay: ${0.2 + taskIndex * 0.1}s"
                                            ></div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- 右侧：年度对比情况 -->
                        <div>
                            <div class="relative mb-4">
                                <div class="flex justify-center items-center">
                                    <h4 class="text-xl font-semibold text-secondary flex items-center">
                                        <i class="fa fa-exchange mr-2 fa-xl"></i>
                                        2024-2025年任务完成对比
                                    </h4>
                                    <span class="mx-3"></span>
                                    <div class="px-4 py-2 rounded-full bg-secondary/20 text-secondary font-semibold text-lg">
                                        综合进步率: <i class="fa fa-arrow-up mr-1"></i>${progressRate}%
                                    </div>
                                </div>
                                <!-- 统一图例 -->
                                <div class="absolute right-0 bottom-0 flex items-center space-x-4 text-sm text-white/70">
                                    <div class="flex items-center">
                                        <span class="inline-block w-3 h-3 bg-[#165DFF] mr-1"></span>
                                        <span>2024年</span>
                                    </div>
                                    <div class="flex items-center">
                                        <span class="inline-block w-3 h-3 bg-[#FFC107] mr-1"></span>
                                        <span>2025年</span>
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-4 gap-3">
                                ${limitedComparisonTasks.map((task, taskIndex) => {
                                    // 获取具体数值，若没有则使用完成率作为示例值
                                    const value2024 = task.value2024 ?? (task.completion2024 * 1000 ?? 0);
                                    const value2025 = task.value2025 ?? (task.completion2025 * 1000 ?? 0);
                                    

                                    
                                    // 生成唯一的canvas ID
                                    const canvasId = `bar-chart-${collegeIndex}-${taskIndex}`;
                                    
                                    // 将图表初始化代码添加到页面中
                                    setTimeout(() => {
                                        const ctx = document.getElementById(canvasId).getContext('2d');
                                        new Chart(ctx, {
                                            type: 'bar',
                                            data: {
                                                labels: [''], // 单一横坐标
                                                datasets: [
                                                    {
                                                        label: '2024年',
                                                        data: [value2024],
                                                        backgroundColor: '#165DFF',
                                                        borderColor: 'transparent',
                                                        borderWidth: 1,
                                                        borderRadius: 3,
                                                        barThickness: 20,
                                                        barPercentage: 0.45,
                                                        categoryPercentage: 0.9
                                                    },
                                                    {
                                                        label: '2025年',
                                                        data: [value2025],
                                                        backgroundColor: '#FFC107', // 改为黄色
                                                        borderColor: 'transparent',
                                                        borderWidth: 1,
                                                        borderRadius: 3,
                                                        barThickness: 20,
                                                        barPercentage: 0.45,
                                                        categoryPercentage: 0.9
                                                    }
                                                ]
                                            },
                                            options: {
                                                responsive: true,
                                                maintainAspectRatio: false,
                                                layout: {
                                                    padding: {
                                                        top: 30 // 为顶部数值预留足够空间
                                                    }
                                                },
                                                plugins: {
                                                    legend: {
                                                        display: false
                                                    },
                                                    tooltip: {
                                                        callbacks: {
                                                            label: function(context) {
                                                                const label = context.dataset.label || '';
                                                                return `${label}: ${formatValue(context.raw)}`;
                                                            }
                                                        }
                                                    },
                                                    datalabels: {
                                                        enabled: true,
                                                        align: 'top',
                                                        anchor: 'end',
                                                        formatter: function(value) {
                                                            return formatValue(value);
                                                        },
                                                        color: '#ffffff',
                                                        fontSize: 10,
                                                        font: {
                                                            weight: 'bold'
                                                        },
                                                        offset: 5
                                                    }
                                                },
                                                scales: {
                                                    x: {
                                                        display: false, // 隐藏x轴
                                                        beginAtZero: true,
                                                        grid: {
                                                            display: false // 隐藏x轴网格线
                                                        },
                                                        ticks: {
                                                            display: false // 隐藏x轴刻度
                                                        }
                                                    },
                                                    y: {
                                                        display: false, // 隐藏y轴
                                                        beginAtZero: true,
                                                        grid: {
                                                            display: false // 隐藏y轴网格线
                                                        },
                                                        ticks: {
                                                            display: false // 隐藏y轴刻度
                                                        }
                                                    }
                                                }
                                            }
                                        });
                                    }, 100);
                                    
                                    return `
                                        <div class="bg-white/5 rounded-lg p-2 flex items-center space-x-1 flex-1 min-w-[100px]">
                                            <!-- 左侧竖排指标名称 -->
                                            <div class="flex-shrink-0 w-10 h-48 flex items-start justify-end pt-1 pr-1">
                                                <div class="h-full w-full overflow-hidden">
                                                    <div class="h-full w-full writing-vertical-lr overflow-hidden relative">
                                                        <span class="text-xs text-start whitespace-nowrap hover:bg-dark/70 p-1 rounded transition-all inline-block" style="max-height: 100%;">${task.name.replace(/^\d+\.\s*/, '')}</span>
                                                        <!-- 手动添加渐变遮罩模拟省略号效果 -->
                                                        <div class="absolute bottom-0 left-0 w-full h-6 bg-gradient-to-t from-dark/90 to-transparent pointer-events-none"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 右侧图表区域 -->
                                            <div class="flex-1 min-w-0">
                                                <div class="flex justify-end mb-1">
                                                    <span class="text-xs font-bold text-primary">${calculateSingleProgressRate(value2024, value2025)}%</span>
                                                </div>
                                                <div class="h-48 bg-white/5 rounded-md p-1 overflow-hidden">
                                                    <canvas id="${canvasId}"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        // 初始化完成情况图表
        function initCompletionChart(colleges) {
            const ctx = document.getElementById('completion-chart').getContext('2d');
            // const labels = colleges.map(c => c.shortName || c.name);
            const labels = colleges.map(c => {
                let name = c.shortName || c.name;
                // 为"材化学院（含国重实验室）"添加换行
                if (name.includes('（含国重实验室）')) {
                    return name.replace('（含国重实验室）', '\n（含国重实验室）');
                }
                return name;
            });
            const data = colleges.map(c => calculateCompletionRate(c));
            
            // 销毁现有图表
            if (window.completionChart) {
                window.completionChart.destroy();
            }
            
            window.completionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '完成率 (%)',
                        data: data,
                        backgroundColor: data.map(value => {
                            if (value >= 90) return '#00B42A';
                            if (value >= 75) return '#165DFF';
                            if (value >= 60) return '#FF7D00';
                            return '#F53F3F';
                        }),
                        borderColor: data.map(value => {
                            if (value >= 90) return '#00B42A';
                            if (value >= 75) return '#165DFF';
                            if (value >= 60) return '#FF7D00';
                            return '#F53F3F';
                        }),
                        borderWidth: 1,
                        barPercentage: 0.5,
                        categoryPercentage: 0.6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(29, 33, 41, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return `完成率: ${context.raw}%`;
                                }
                            }
                        },
                        // 配置数据标签，在柱子上方显示数字
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            formatter: function(value) {
                                return value + '%';
                            },
                            color: 'rgba(255, 255, 255, 0.9)',
                            font: {
                                size: 12,
                                weight: 'bold'
                            },
                            offset: 8
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: {
                                    size: 12,
                                    lineHeight: 1.2
                                },
                                maxRotation: 0,
                                minRotation: 0,
                                autoSkip: false,
                                usePointStyle: true,
                                // 启用多行标签显示
                                callback: function(value, index, values) {
                                    return labels[index].split('\n');
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 初始化进步趋势图表
        function initProgressChart(colleges) {
            const ctx = document.getElementById('progress-chart').getContext('2d');
            const labels = colleges.map(c => {
                let name = c.shortName || c.name;
                // 为"材化学院（含国重实验室）"添加换行
                if (name.includes('（含国重实验室）')) {
                    return name.replace('（含国重实验室）', '\n（含国重实验室）');
                }
                return name;
            });
            const progressData = colleges.map(c => calculateProgressRate(c));
            
            // 销毁现有图表
            if (window.progressChart) {
                window.progressChart.destroy();
            }
            
            window.progressChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '进步率',
                            data: progressData,
                            backgroundColor: '#0FC6C2',
                            borderColor: '#0FC6C2',
                            borderWidth: 1,
                            barPercentage: 0.6,
                            categoryPercentage: 0.7
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false,
                            position: 'top',
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(29, 33, 41, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 12,
                            mode: 'index',
                            intersect: false
                        },
                        // 配置数据标签，在柱子上方显示数字
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            formatter: function(value) {
                                return value + '%';
                            },
                            color: 'rgba(255, 255, 255, 0.9)',
                            font: {
                                size: 12,
                                weight: 'bold'
                            },
                            offset: 8
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: {
                                    size: 12,
                                    lineHeight: 1.2
                                },
                                maxRotation: 0,
                                minRotation: 0,
                                autoSkip: false,
                                usePointStyle: true,
                                // 启用多行标签显示
                                callback: function(value, index, values) {
                                    return labels[index].split('\n');
                                }
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: '进步率 (%)',
                                color: 'rgba(255, 255, 255, 0.7)'
                            },
                            beginAtZero: true,
                            // 设置y轴最大值为80%，确保数据标签能完整显示
                            max: 80,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#0FC6C2',
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }
        
        // 初始化完成率雷达图
        function initCompletionRadar(colleges) {
            const ctx = document.getElementById('completion-radar').getContext('2d');
            const labels = colleges.map(c => c.shortName || c.name);
            const data = colleges.map(c => calculateCompletionRate(c));
            
            // 销毁现有图表
            if (window.completionRadar) {
                window.completionRadar.destroy();
            }
            
            window.completionRadar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '完成率 (%)',
                        data: data,
                        backgroundColor: 'rgba(22, 93, 255, 0.2)',
                        borderColor: '#165DFF',
                        borderWidth: 2,
                        pointBackgroundColor: '#165DFF',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#165DFF'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(29, 33, 41, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 12
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            pointLabels: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: {
                                    size: 16
                                }
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.5)',
                                callback: function(value) {
                                    return value + '%';
                                },
                                showLabelBackdrop: false
                            }
                        }
                    }
                }
            });
        }
        
        // 初始化进步率雷达图
        function initProgressRadar(colleges) {
            const ctx = document.getElementById('progress-radar').getContext('2d');
            const labels = colleges.map(c => c.shortName || c.name);
            const data = colleges.map(c => {
                const progress = calculateProgressRate(c);
                // 负值设为0
                return Math.max(progress, 0);
            });
            
            // 销毁现有图表
            if (window.progressRadar) {
                window.progressRadar.destroy();
            }
            
            window.progressRadar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '进步率 (%)',
                        data: data,
                        backgroundColor: 'rgba(15, 198, 194, 0.2)',
                        borderColor: '#0FC6C2',
                        borderWidth: 2,
                        pointBackgroundColor: '#0FC6C2',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#0FC6C2'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(29, 33, 41, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 12
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            pointLabels: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: {
                                    size: 16
                                }
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.5)',
                                callback: function(value) {
                                    return value + '%';
                                },
                                showLabelBackdrop: false
                            }
                        }
                    }
                }
            });
        }
        

        
        // 初始化赛道切换
        function initTabs() {
            // 合并情况赛道切换
            document.getElementById('science-tab').addEventListener('click', () => {
                // 重置所有标签状态
                document.querySelectorAll('[id$="-tab"]').forEach(btn => {
                    btn.classList.remove('bg-primary');
                    btn.classList.add('bg-white/10', 'hover:bg-white/20');
                });
                
                // 显示当前标签
                document.getElementById('science-tab').classList.add('bg-primary');
                document.getElementById('science-tab').classList.remove('bg-white/10', 'hover:bg-white/20');
                
                // 隐藏所有内容
                document.getElementById('science-content').classList.add('hidden');
                document.getElementById('humanity-content').classList.add('hidden');
                document.getElementById('platform-content').classList.add('hidden');
                document.getElementById('institution-content').classList.add('hidden');
                
                // 显示当前内容
                document.getElementById('science-content').classList.remove('hidden');
                
                // 更新统计图表
                initCompletionRank(scienceColleges);
                initCompletionChart(scienceColleges);
                initCompletionRadar(scienceColleges);
                initProgressRank(scienceColleges);
                initProgressChart(scienceColleges);
                initProgressRadar(scienceColleges);
            });
            
            document.getElementById('humanity-tab').addEventListener('click', () => {
                // 重置所有标签状态
                document.querySelectorAll('[id$="-tab"]').forEach(btn => {
                    btn.classList.remove('bg-primary');
                    btn.classList.add('bg-white/10', 'hover:bg-white/20');
                });
                
                // 显示当前标签
                document.getElementById('humanity-tab').classList.add('bg-primary');
                document.getElementById('humanity-tab').classList.remove('bg-white/10', 'hover:bg-white/20');
                
                // 隐藏所有内容
                document.getElementById('science-content').classList.add('hidden');
                document.getElementById('humanity-content').classList.add('hidden');
                document.getElementById('platform-content').classList.add('hidden');
                document.getElementById('institution-content').classList.add('hidden');
                
                // 显示当前内容
                document.getElementById('humanity-content').classList.remove('hidden');
                
                // 更新统计图表
                initCompletionRank(humanityColleges);
                initCompletionChart(humanityColleges);
                initCompletionRadar(humanityColleges);
                initProgressRank(humanityColleges);
                initProgressChart(humanityColleges);
                initProgressRadar(humanityColleges);
            });
            
            // 独立平台标签事件
            document.getElementById('platform-tab').addEventListener('click', () => {
                // 重置所有标签状态
                document.querySelectorAll('[id$="-tab"]').forEach(btn => {
                    btn.classList.remove('bg-primary');
                    btn.classList.add('bg-white/10', 'hover:bg-white/20');
                });
                
                // 显示当前标签
                document.getElementById('platform-tab').classList.add('bg-primary');
                document.getElementById('platform-tab').classList.remove('bg-white/10', 'hover:bg-white/20');
                
                // 隐藏所有内容
                document.getElementById('science-content').classList.add('hidden');
                document.getElementById('humanity-content').classList.add('hidden');
                document.getElementById('platform-content').classList.add('hidden');
                document.getElementById('institution-content').classList.add('hidden');
                
                // 显示当前内容
                document.getElementById('platform-content').classList.remove('hidden');
                
                // 更新统计图表
                initCompletionRank(platformColleges);
                initCompletionChart(platformColleges);
                initCompletionRadar(platformColleges);
                initProgressRank(platformColleges);
                initProgressChart(platformColleges);
                initProgressRadar(platformColleges);
            });
            
            // 新型研发机构标签事件
            document.getElementById('institution-tab').addEventListener('click', () => {
                // 重置所有标签状态
                document.querySelectorAll('[id$="-tab"]').forEach(btn => {
                    btn.classList.remove('bg-primary');
                    btn.classList.add('bg-white/10', 'hover:bg-white/20');
                });
                
                // 显示当前标签
                document.getElementById('institution-tab').classList.add('bg-primary');
                document.getElementById('institution-tab').classList.remove('bg-white/10', 'hover:bg-white/20');
                
                // 隐藏所有内容
                document.getElementById('science-content').classList.add('hidden');
                document.getElementById('humanity-content').classList.add('hidden');
                document.getElementById('platform-content').classList.add('hidden');
                document.getElementById('institution-content').classList.add('hidden');
                
                // 显示当前内容
                document.getElementById('institution-content').classList.remove('hidden');
                
                // 更新统计图表
                initCompletionRank(institutionColleges);
                initCompletionChart(institutionColleges);
                initCompletionRadar(institutionColleges);
                initProgressRank(institutionColleges);
                initProgressChart(institutionColleges);
                initProgressRadar(institutionColleges);
            });
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 更新时间
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // 初始设置合并section的显示状态
            const mergedSection = document.getElementById('merged-section');
            const summarySection = document.getElementById('summary-section');
            
            // 确保所有section默认可见
            mergedSection.style.display = 'block';
            mergedSection.style.opacity = '1';
            summarySection.style.display = 'block';
            summarySection.style.opacity = '1';
            
            // 初始化赛道切换
            initTabs();
            
            // 初始加载数据
            renderMergedCollegeCards(scienceColleges, 'science-content');
            renderMergedCollegeCards(humanityColleges, 'humanity-content');
            renderMergedCollegeCards(platformColleges, 'platform-content');
            renderMergedCollegeCards(institutionColleges, 'institution-content');
            
            // 初始化排行榜和图表
            initCompletionRank(scienceColleges);
            initCompletionChart(scienceColleges);
            initCompletionRadar(scienceColleges);
            initProgressRank(scienceColleges);
            initProgressChart(scienceColleges);
            initProgressRadar(scienceColleges);
            
            // 添加响应式调整
            window.addEventListener('resize', () => {
                const currentColleges = document.getElementById('science-content').classList.contains('hidden') ? humanityColleges : scienceColleges;
                initCompletionChart(currentColleges);
                initCompletionRadar(currentColleges);
                initProgressChart(currentColleges);
                initProgressRadar(currentColleges);
            });
        });
        
    </script>
    
    <!-- 回到顶部按钮 -->
    <button id="back-to-top" class="fixed bottom-8 right-8 bg-primary/80 hover:bg-primary text-white w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 opacity-0 invisible z-50">
        <i class="fa fa-chevron-up"></i>
    </button>
    
    <script>
        // 回到顶部按钮功能
        const backToTopButton = document.getElementById('back-to-top');
        
        // 监听滚动事件
        window.addEventListener('scroll', () => {
            // 当页面滚动超过500px时显示按钮
            if (window.scrollY > 500) {
                backToTopButton.classList.remove('opacity-0', 'invisible');
                backToTopButton.classList.add('opacity-100', 'visible');
            } else {
                backToTopButton.classList.remove('opacity-100', 'visible');
                backToTopButton.classList.add('opacity-0', 'invisible');
            }
        });
        
        // 点击按钮回到顶部
        backToTopButton.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    </script>
</body>
</html>